<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="keccakStylesheet.css">
    <title>Keccak-f[25] Implementation</title>
</head>

<body>



    <h3>Keccak-f[25] Implementation</h3>

    <table id="frame">
        <th>
            <tr>
                <td>Input A[x,y]</td>
                <td>→</td>
                <td>Output New A[x,y]</td>
            </tr>
        </th>

        <tbody>
            <tr>
                <td align="center">
                    <table id="input">
                        <tr>
                            <td><input id="b00" type="number" min=0 max=1 value=0></td>
                            <td><input id="b01" type="number" min=0 max=1 value=0></td>
                            <td><input id="b02" type="number" min=0 max=1 value=0></td>
                            <td><input id="b03" type="number" min=0 max=1 value=0></td>
                            <td><input id="b04" type="number" min=0 max=1 value=0></td>
                        </tr>
                        <tr>
                            <td><input id="b10" type="number" min=0 max=1 value=0></td>
                            <td><input id="b11" type="number" min=0 max=1 value=0></td>
                            <td><input id="b12" type="number" min=0 max=1 value=0></td>
                            <td><input id="b13" type="number" min=0 max=1 value=0></td>
                            <td><input id="b14" type="number" min=0 max=1 value=0></td>
                        </tr>
                        <tr>
                            <td><input id="b20" type="number" min=0 max=1 value=0></td>
                            <td><input id="b21" type="number" min=0 max=1 value=0></td>
                            <td><input id="b22" type="number" min=0 max=1 value=0></td>
                            <td><input id="b23" type="number" min=0 max=1 value=0></td>
                            <td><input id="b24" type="number" min=0 max=1 value=0></td>
                        </tr>
                        <tr>
                            <td><input id="b30" type="number" min=0 max=1 value=0></td>
                            <td><input id="b31" type="number" min=0 max=1 value=0></td>
                            <td><input id="b32" type="number" min=0 max=1 value=0></td>
                            <td><input id="b33" type="number" min=0 max=1 value=0></td>
                            <td><input id="b34" type="number" min=0 max=1 value=0></td>
                        </tr>
                        <tr>
                            <td><input id="b40" type="number" min=0 max=1 value=0></td>
                            <td><input id="b41" type="number" min=0 max=1 value=0></td>
                            <td><input id="b42" type="number" min=0 max=1 value=0></td>
                            <td><input id="b43" type="number" min=0 max=1 value=0></td>
                            <td><input id="b44" type="number" min=0 max=1 value=0></td>
                        </tr>
                    </table>
                </td>

                <td><button id="show" onclick="keccak()">Show →</button></td>
                <td align="center">
                    <table id="output">
                        <tr>
                            <td id="a00" value=0>0</td>
                            <td id="a01" value=0>0</td>
                            <td id="a02" value=0>0</td>
                            <td id="a03" value=0>0</td>
                            <td id="a04" value=0>0</td>
                        </tr>
                        <tr>
                            <td id="a10" value=0>0</td>
                            <td id="a11" value=0>0</td>
                            <td id="a12" value=0>0</td>
                            <td id="a13" value=0>0</td>
                            <td id="a14" value=0>0</td>
                        </tr>
                        <tr>
                            <td id="a20" value=0>0</td>
                            <td id="a21" value=0>0</td>
                            <td id="a22" value=0>0</td>
                            <td id="a23" value=0>0</td>
                            <td id="a24" value=0>0</td>
                        </tr>
                        <tr>
                            <td id="a30" value=0>0</td>
                            <td id="a31" value=0>0</td>
                            <td id="a32" value=0>0</td>
                            <td id="a33" value=0>0</td>
                            <td id="a34" value=0>0</td>
                        </tr>
                        <tr>
                            <td id="a40" value=0>0</td>
                            <td id="a41" value=0>0</td>
                            <td id="a42" value=0>0</td>
                            <td id="a43" value=0>0</td>
                            <td id="a44" value=0>0</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </tbody>
    </table>

    <script>
        var a = [];
        var round = 12;

        function keccak() {
            readInput();

            for (i = 0; i < 12; i++) {
                theta();
                pi();
                chi();
                lota();
            }

        }

        //read input and store as matrix
        function readInput() {
            let bpos = "b"
            for (i = 0; i < 5; i++) {
                for (j = 0; j < 5; j++) {
                    var row = [];

                    row[j] = document.getElementById(bpos + i + j).value;
                }
                a[i] = row;
            }
        }

        // theta step
        function theta() {
            let c = [];
            let d = [];
            for (i = 0; i < 5; i++) {
                c[i] = a[i][0] ^ a[i][1] ^ a[i][2] ^ a[i][3] ^ a[i][4];
            }

            for (i = 0; i < 5; i++) {

                // i + 4 mod 5 should equals to i - 1 mod 5, and since javascript
                // cannnot handle negative number mod, therefore i+4 is used here.
                d[i] = c[(i + 4) % 5] ^ c[(i + 1) % 5];
            }

            for (i = 0; i < 5; i++) {
                for (j = 0; i < 5; j++) {
                    a[i][j] = a[i][j] ^ d[j];
                }
            }
        }

        function pi() {
            let b = a;

            for (i = 0; i < 5; i++) {

                //arrange the row index to fit the order of a slice (2 1 0 4 3)
                let y = (5 - ((i + 3) % 5)) % 5;
                for (j = 0; j < 5; j++) {

                    //arrange the column index to fit the order of a slice (3 4 0 1 2)
                    let x = (j + 3) % 5;

                    b[x][(2 * y + 3 * x) % 5] = a[y][x];
                }
            }

            //update a
            a = b;
        }

        // chi step
        function chi(a) {

            let compA = [];
            let shiftA = [];

            for (i = 0; i < 5; i++) {
                for (j = 0; j < 5; j++) {

                    var m = (j + 1) % 5;
                    var n = (j + 2) % 5;

                    compA[i][j] = (~a[i][m]) + 2;
                    shiftA[i][j] = a[i][n];
                    a[i][j] = a[i][j] ^ (compA[i][j] & shiftA[i][j]);
                }
            }

        }



        function lota() {

        }



        function print(pos, val) {
            document.getElementById(pos).innerHTML = "";
            document.getElementById(pos).innerHTML = val;
            document.getElementById(pos).value = Number(val);
        }


    </script>



</body>

</html>