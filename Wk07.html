<!DOCTYPE html>
<html>

<body>



    <h3>AES Encryption - Decryption</h3>

    <table cellspacing="30">
        <tr>
            <td>32 hexadecimal dgits key (128 bits):</td>
            <td><textarea id="key" cols="60" rows="2"></textarea></td>
            <td><button onclick="checkKey()">
                    check</button></td>
        </tr>

        <tr>
            <td>Choose a file:</td>
            <td><input type="file" id="files" name="files[]"><output id="fileInfo"></output></td>
        </tr>

        <tr>
            <td>File contents:</td>
            <td><textarea id="fileContent" cols="60" rows="10" readonly></textarea></td>
        </tr>

        <tr>
            <td>Message for authentication:</td>
            <td><textarea id="message" onchange="input()" cols="60" rows="3"></textarea></td>
        </tr>
        <tr>
            <td id="e"></td>
            <td><button onclick="encrypt()">
                    Encrypt ↓</button>
                <span></span>
                <button onclick="decrypt()">
                    Decrypt ↑</button></td>

        </tr>
        <tr>
            <td>Encrypted file:</td>
            <td><textarea id="encryptedFile" cols="60" rows="10" readonly></textarea></td>
        </tr>

        <tr>
            <td>HMAC:</td>
            <td><input type="text" id="hmac" cols="60" rows="2"></td>

        </tr>
        <tr>
            <td>Save file:</td>
            <td><input type="text" id="savename">
                <button onclick="save()">
                    Save to file</button>
            </td>
        </tr>

        <tr>
            <td>Save file with encrypted info:</td>
            <td><input type="var" id="s">
                <button onclick="save()">
                    Save to file</button>
            </td>
        </tr>

    </table>

    <script>
        function handleFileSelect(evt) {
            var files = evt.target.files; // FileList object
            var output = document.getElementById("fileContent");

            // files is a FileList of File objects. List some properties.
            var output = [];
            f = files[0]

            output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                f.size, ' bytes, last modified: ',
                f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
                '</li>');

            document.getElementById('fileInfo').innerHTML = '<ul>' + output.join('') + '</ul>';

            var reader = new FileReader();
            reader.addEventListener("load", function (event) {

                var textFile = event.target;
                document.getElementById("fileContent").value = textFile.result;

            });

            reader.readAsText(f);


        }

        document.getElementById('files').addEventListener('change', handleFileSelect, false);


        function checkKey() {
            var input = document.getElementById("key").value;
            var split = input.split(" ");
            var key = split.join("");
            var isHex = Boolean(key.match(/^[0-9a-f]+$/i));

            if(isHex == false || key.length != 32){
                document.getElementById("key").value = "invalid key";
            }

        }



        function gene() {
            var fin = document.getElementById("fin").value;
            var e = [];

            for (i = 0; i < fin; i++) {
                if (euclidean(i, fin) == 1) {
                    e.push(i);
                }
            }
            document.getElementById("e").value = e[Math.floor((Math.random() * e.length))];
            document.getElementById("e").innerHTML = document.getElementById("e").value;
            // document.getElementById("test").innerHTML = document.getElementById("e").value;
        }


        function euclidean(a, b) {

            if (!isNaN(a) && !isNaN(b) && a > 0 && b > 0) {

                var temp = 1;
                while (temp != 0) {
                    temp = a % b;
                    a = b;
                    b = temp;
                }
                return a

            } else {
                document.getElementById("e").innerHTML = "invalid input";
            }

        }

        function gend() {
            var fin = document.getElementById("fin").value;
            var e = document.getElementById("e").value;
            for (d = 0; d < fin; d++) {
                var temp = d * e - 1;
                // d*e - x*fin = 1
                if (temp % fin == 0) {
                    document.getElementById("d").innerHTML = d;
                    document.getElementById("d").value = d;
                    return d;
                }
            }
        }

        function signing() {
            var m = document.getElementById("m").value;
            var n = document.getElementById("n").value;
            var d = document.getElementById("d").value.toString(2);
            // document.getElementById("test").innerHTML = d;
            var s = fastexp(m, n, d);
            // var s = 1;
            // var temp = m % n;

            // for (i = d.length - 1; i >= 0; i--) {

            //     if (d.charAt(i) != 0) {
            //         s = s * temp % n;
            //     }
            //     temp = temp*temp % n;

            // }
            document.getElementById("s").value = s;
        }

        function veryfying() {
            var s = document.getElementById("s").value;
            var n = document.getElementById("n").value;
            var e = document.getElementById("e").value.toString(2);
            var m = fastexp(s, n, e);

            document.getElementById("m").value = m;

        }

        function fastexp(b, m, e) {
            var s = 1;
            var temp = b % m;

            for (i = e.length - 1; i >= 0; i--) {

                if (e.charAt(i) != 0) {
                    s = s * temp % m;
                }
                temp = temp * temp % m;

            }
            return s;
        }

        function clear() {
            document.getElementById("m").value = "";
        }


    </script>



</body>

</html>